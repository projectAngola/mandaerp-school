
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manda ERP - Gestão Escolar</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary-blue: #0d6efd;
            --dark-blue: #0a58ca;
            --light-blue: #cfe2ff;
            --sidebar-bg: #0b3d78;
            --sidebar-hover: #0a2f5c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
        }

        /* Loading Spinner */
        #loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        #loading-spinner.active {
            display: flex;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        /* Mobile-First Sidebar/Navbar */
        .sidebar {
            height: 100vh;
            background-color: var(--sidebar-bg);
            transition: all 0.3s;
        }

        .sidebar .navbar-brand {
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
        }

        .sidebar .navbar-brand i {
            margin-right: 10px;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 0.8rem 1.5rem;
            transition: all 0.2s;
            border-radius: 0.25rem;
            margin: 0.1rem 0.5rem;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: var(--sidebar-hover);
        }

        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            padding-bottom: 60px; /* Space for footer */
        }

        .page-container {
            display: none;
        }

        .page-container.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            margin-bottom: 1.5rem;
        }

        .card-header {
            background-color: var(--primary-blue);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .btn-primary:hover {
            background-color: var(--dark-blue);
            border-color: var(--dark-blue);
        }

        .dataTables_wrapper .dataTables_filter input {
            border: 1px solid #ced4da;
            border-radius: 5px;
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .login-card .brand {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-blue);
        }

        .status-pendente { color: #dc3545; font-weight: bold; }
        .status-pago { color: #198754; font-weight: bold; }
        .status-ativa { color: #198754; font-weight: bold; }
        .status-inativa { color: #6c757d; font-weight: bold; }

        /* Schedule Table */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }
        .schedule-table th, .schedule-table td {
            border: 1px solid #dee2e6;
            padding: 0.5rem;
            text-align: center;
            vertical-align: middle;
            font-size: 0.9rem;
        }
        .schedule-table th {
            background-color: var(--light-blue);
        }
        .schedule-table .schedule-item {
            background-color: var(--primary-blue);
            color: white;
            border-radius: 4px;
            padding: 2px 5px;
            margin: 1px;
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Receipt Print Styles */
        @media print {
            body * { visibility: hidden; }
            #receipt-modal, #receipt-modal * { visibility: visible; }
            #receipt-modal { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
        }
        .receipt-body {
            padding: 20px;
            font-family: 'Courier New', Courier, monospace;
        }
        .receipt-header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 20px; }
        .receipt-footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #555; }

        /* Footer */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #343a40;
            color: #fff;
            text-align: center;
            padding: 10px 0;
            font-size: 0.8rem;
            z-index: 1000;
        }
        @media (min-width: 768px) {
            footer { left: 250px; width: calc(100% - 250px); }
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 250px;
                z-index: 1000;
                padding-top: 0;
            }
            .sidebar .navbar-nav {
                flex-direction: column;
                width: 100%;
            }
            .main-content {
                margin-left: 250px;
                padding: 2rem 2rem 80px 2rem;
            }
        }
    </style>
</head>
<body>

    <!-- ========= LOGIN PAGE ========= -->
    <div id="login-page" class="login-container">
        <div class="card login-card">
            <div class="brand">
                <i class="fas fa-graduation-cap fa-2x"></i>
                <h2>Manda ERP School</h2>
            </div>
            <form id="login-form">
                <div class="mb-3">
                    <label for="username" class="form-label">Usuário</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Senha</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Entrar</button>
                <div class="mt-3 text-center small text-muted">
                    <p>Demo: <strong>admin/admin</strong> ou <strong>user/user</strong></p>
                </div>
            </form>
        </div>
    </div>

    <!-- ========= MAIN APP ========= -->
    <div id="main-app" style="display: none;">
        <!-- Loading Spinner -->
        <div id="loading-spinner">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
        </div>

        <!-- Sidebar/Navbar -->
        <nav class="navbar navbar-expand-md navbar-dark sidebar d-md-block">
            <div class="container-fluid">
                <a class="navbar-brand d-md-none" href="#">
                    <i class="fas fa-graduation-cap"></i> Manda ERP School 
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-nav" aria-controls="sidebar-nav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="sidebar-nav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active d-none d-md-block" href="#">
                                <i class="fas fa-graduation-cap"></i> Manda ERP School <small class="d-block fs-6 opacity-75">AGT 473/AGT/2024</small>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="dashboard">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="secretaria">
                                <i class="fas fa-school"></i> Secretaria
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="pedagogico">
                                <i class="fas fa-book-open"></i> Pedagógico
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="planos-aula">
                                <i class="fas fa-chalkboard"></i> Planos de Aula
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="financeiro">
                                <i class="fas fa-dollar-sign"></i> Financeiro
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="matriculas">
                                <i class="fas fa-user-plus"></i> Matrículas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="horarios">
                                <i class="fas fa-clock"></i> Horários
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="presenca">
                                <i class="fas fa-check-circle"></i> Presença
                            </a>
                        </li>
                        <li class="nav-item mt-auto">
                            <a class="nav-link text-danger" href="#" id="logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Sair
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2" id="page-title">Dashboard</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <span class="text-muted">Bem-vindo, <span id="user-name"></span> (<span id="user-role"></span>)</span>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page-container active">
                <div class="row">
                    <div class="col-6 col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <h5 class="card-title">Alunos</h5>
                                <p class="card-text fs-4" id="total-alunos">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-chalkboard-teacher fa-2x text-success mb-2"></i>
                                <h5 class="card-title">Professores</h5>
                                <p class="card-text fs-4" id="total-professores">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-door-open fa-2x text-warning mb-2"></i>
                                <h5 class="card-title">Turmas</h5>
                                <p class="card-text fs-4" id="total-turmas">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-user-check fa-2x text-info mb-2"></i>
                                <h5 class="card-title">Matrículas</h5>
                                <p class="card-text fs-4" id="total-matriculas">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secretaria Page -->
            <div id="secretaria" class="page-container">
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-users"></i> Alunos</span>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#alunoModal" onclick="openAlunoModal()">
                                    <i class="fas fa-plus"></i> Novo Aluno
                                </button>
                            </div>
                            <div class="card-body">
                                <table id="alunos-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nome</th>
                                            <th>Data Nasc.</th>
                                            <th>Responsável</th>
                                            <th>Contato</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-chalkboard-teacher"></i> Professores</span>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#professorModal" onclick="openProfessorModal()">
                                    <i class="fas fa-plus"></i> Novo Professor
                                </button>
                            </div>
                            <div class="card-body">
                                <table id="professores-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nome</th>
                                            <th>Disciplina</th>
                                            <th>Email</th>
                                            <th>Contato</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pedagogico Page -->
            <div id="pedagogico" class="page-container">
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-door-open"></i> Turmas</span>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#turmaModal" onclick="openTurmaModal()">
                                    <i class="fas fa-plus"></i> Nova Turma
                                </button>
                            </div>
                            <div class="card-body">
                                <table id="turmas-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nome</th>
                                            <th>Série</th>
                                            <th>Ano Letivo</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-book"></i> Disciplinas</span>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#disciplinaModal" onclick="openDisciplinaModal()">
                                    <i class="fas fa-plus"></i> Nova Disciplina
                                </button>
                            </div>
                            <div class="card-body">
                                <table id="disciplinas-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nome</th>
                                            <th>Carga Horária</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planos de Aula Page -->
            <div id="planos-aula" class="page-container">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-chalkboard"></i> Planos de Aula</span>
                        <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#planoAulaModal" onclick="openPlanoAulaModal()">
                            <i class="fas fa-plus"></i> Novo Plano
                        </button>
                    </div>
                    <div class="card-body">
                        <table id="planos-aula-table" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Professor</th>
                                    <th>Turma</th>
                                    <th>Disciplina</th>
                                    <th>Data da Aula</th>
                                    <th>Conteúdo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Financeiro Page -->
            <div id="financeiro" class="page-container">
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-receipt"></i> Conta Corrente (Lançamentos)</span>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#financeiroModal" onclick="openFinanceiroModal()">
                                    <i class="fas fa-plus"></i> Novo Lançamento
                                </button>
                            </div>
                            <div class="card-body">
                                <table id="financeiro-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Aluno</th>
                                            <th>Descrição</th>
                                            <th>Valor</th>
                                            <th>Vencimento</th>
                                            <th>Status</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="fas fa-exclamation-triangle"></i> Mapa de Devedores</span>
                            </div>
                            <div class="card-body">
                                <table id="devedores-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Aluno</th>
                                            <th>Responsável</th>
                                            <th>Contato</th>
                                            <th>Valor Total Devido</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Matriculas Page -->
            <div id="matriculas" class="page-container">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-user-plus"></i> Matrículas e Confirmação</span>
                        <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#matriculaModal" onclick="openMatriculaModal()">
                            <i class="fas fa-plus"></i> Nova Matrícula
                        </button>
                    </div>
                    <div class="card-body">
                        <table id="matriculas-table" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Aluno</th>
                                    <th>Turma</th>
                                    <th>Data da Matrícula</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Horarios Page -->
            <div id="horarios" class="page-container">
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-clock"></i> Gestão de Horários</span>
                                <button class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#horarioModal" onclick="openHorarioModal()">
                                    <i class="fas fa-plus"></i> Adicionar Horário
                                </button>
                            </div>
                            <div class="card-body">
                                <table id="horarios-table" class="table table-striped table-hover" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Turma</th>
                                            <th>Disciplina</th>
                                            <th>Professor</th>
                                            <th>Dia da Semana</th>
                                            <th>Horário</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="fas fa-user-clock"></i> Horário do Professor</span>
                            </div>
                            <div class="card-body">
                                <select class="form-select mb-3" id="select-professor-horario">
                                    <option value="">Selecione um professor...</option>
                                </select>
                                <div id="horario-professor-view"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="fas fa-users-clock"></i> Horário da Turma</span>
                            </div>
                            <div class="card-body">
                                <select class="form-select mb-3" id="select-turma-horario">
                                    <option value="">Selecione uma turma...</option>
                                </select>
                                <div id="horario-turma-view"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Presenca Page -->
            <div id="presenca" class="page-container">
                <div class="card">
                    <div class="card-header">
                        <span><i class="fas fa-check-circle"></i> Lista de Presença</span>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="presenca-turma" class="form-label">Turma</label>
                                <select class="form-select" id="presenca-turma">
                                    <option value="">Selecione uma turma...</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="presenca-data" class="form-label">Data</label>
                                <input type="date" class="form-control" id="presenca-data">
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="carregarListaPresenca()">
                                    <i class="fas fa-search"></i> Gerar Lista
                                </button>
                            </div>
                        </div>
                        <div id="presenca-list-container"></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Footer -->
    <footer>
        &copy; 2025 Desenvolvido por Manda ERP para Polyglot Academy | Licenciado pela AGT nº 473/AGT/2024
    </footer>

    <!-- ========= MODALS ========= -->
    <!-- Modal Aluno -->
    <div class="modal fade" id="alunoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar/Editar Aluno</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="aluno-form">
                        <input type="hidden" id="aluno-id">
                        <div class="mb-3">
                            <label for="aluno-nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="aluno-nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="aluno-nascimento" class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-control" id="aluno-nascimento" required>
                        </div>
                        <div class="mb-3">
                            <label for="aluno-responsavel" class="form-label">Responsável</label>
                            <input type="text" class="form-control" id="aluno-responsavel" required>
                        </div>
                        <div class="mb-3">
                            <label for="aluno-contato" class="form-label">Contato</label>
                            <input type="tel" class="form-control" id="aluno-contato" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveAluno()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Professor -->
    <div class="modal fade" id="professorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar/Editar Professor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="professor-form">
                        <input type="hidden" id="professor-id">
                        <div class="mb-3">
                            <label for="professor-nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="professor-nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="professor-disciplina" class="form-label">Disciplina Principal</label>
                            <input type="text" class="form-control" id="professor-disciplina" required>
                        </div>
                        <div class="mb-3">
                            <label for="professor-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="professor-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="professor-contato" class="form-label">Contato</label>
                            <input type="tel" class="form-control" id="professor-contato" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveProfessor()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Turma -->
    <div class="modal fade" id="turmaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar/Editar Turma</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="turma-form">
                        <input type="hidden" id="turma-id">
                        <div class="mb-3">
                            <label for="turma-nome" class="form-label">Nome da Turma</label>
                            <input type="text" class="form-control" id="turma-nome" placeholder="Ex: 1º Ano A" required>
                        </div>
                        <div class="mb-3">
                            <label for="turma-serie" class="form-label">Série</label>
                            <input type="text" class="form-control" id="turma-serie" placeholder="Ex: 1º Ano do Ensino Fundamental" required>
                        </div>
                        <div class="mb-3">
                            <label for="turma-ano" class="form-label">Ano Letivo</label>
                            <input type="number" class="form-control" id="turma-ano" value="2024" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveTurma()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Disciplina -->
    <div class="modal fade" id="disciplinaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar/Editar Disciplina</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="disciplina-form">
                        <input type="hidden" id="disciplina-id">
                        <div class="mb-3">
                            <label for="disciplina-nome" class="form-label">Nome da Disciplina</label>
                            <input type="text" class="form-control" id="disciplina-nome" placeholder="Ex: Matemática" required>
                        </div>
                        <div class="mb-3">
                            <label for="disciplina-carga" class="form-label">Carga Horária (h/a)</label>
                            <input type="number" class="form-control" id="disciplina-carga" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveDisciplina()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Financeiro -->
    <div class="modal fade" id="financeiroModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar/Editar Lançamento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="financeiro-form">
                        <input type="hidden" id="financeiro-id">
                        <div class="mb-3">
                            <label for="financeiro-aluno" class="form-label">Aluno</label>
                            <select class="form-select" id="financeiro-aluno" required>
                                <option value="" selected disabled>Selecione um aluno...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="financeiro-descricao" class="form-label">Descrição</label>
                            <input type="text" class="form-control" id="financeiro-descricao" placeholder="Ex: Mensalidade Março/2024" required>
                        </div>
                        <div class="mb-3">
                            <label for="financeiro-valor" class="form-label">Valor (R$)</label>
                            <input type="number" class="form-control" id="financeiro-valor" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="financeiro-vencimento" class="form-label">Data de Vencimento</label>
                            <input type="date" class="form-control" id="financeiro-vencimento" required>
                        </div>
                        <div class="mb-3">
                            <label for="financeiro-status" class="form-label">Status</label>
                            <select class="form-select" id="financeiro-status" required>
                                <option value="Pendente">Pendente</option>
                                <option value="Pago">Pago</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveFinanceiro()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Conta Corrente -->
    <div class="modal fade" id="contaCorrenteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Extrato da Conta Corrente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 id="conta-corrente-aluno-nome"></h6>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descrição</th>
                                <th>Valor</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="conta-corrente-tbody">
                        </tbody>
                    </table>
                    <h5 class="text-end">Total Devido: <span id="conta-corrente-total">R$ 0,00</span></h5>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Recibo -->
    <div class="modal fade" id="receipt-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header no-print">
                    <h5 class="modal-title">Recibo de Pagamento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="receipt-body" id="receipt-content">
                    <!-- Content will be dynamically generated -->
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="window.print()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Matricula -->
    <div class="modal fade" id="matriculaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nova Matrícula</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="matricula-form">
                        <div class="mb-3">
                            <label for="matricula-aluno" class="form-label">Aluno</label>
                            <select class="form-select" id="matricula-aluno" required>
                                <option value="" selected disabled>Selecione um aluno...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="matricula-turma" class="form-label">Turma</label>
                            <select class="form-select" id="matricula-turma" required>
                                <option value="" selected disabled>Selecione uma turma...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="matricula-data" class="form-label">Data da Matrícula</label>
                            <input type="date" class="form-control" id="matricula-data" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveMatricula()">Salvar Matrícula</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Horario -->
    <div class="modal fade" id="horarioModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Horário</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="horario-form">
                        <div class="mb-3">
                            <label for="horario-turma" class="form-label">Turma</label>
                            <select class="form-select" id="horario-turma" required>
                                <option value="" selected disabled>Selecione uma turma...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="horario-disciplina" class="form-label">Disciplina</label>
                            <select class="form-select" id="horario-disciplina" required>
                                <option value="" selected disabled>Selecione uma disciplina...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="horario-professor" class="form-label">Professor</label>
                            <select class="form-select" id="horario-professor" required>
                                <option value="" selected disabled>Selecione um professor...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="horario-dia" class="form-label">Dia da Semana</label>
                            <select class="form-select" id="horario-dia" required>
                                <option value="Segunda">Segunda-feira</option>
                                <option value="Terca">Terça-feira</option>
                                <option value="Quarta">Quarta-feira</option>
                                <option value="Quinta">Quinta-feira</option>
                                <option value="Sexta">Sexta-feira</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="horario-inicio" class="form-label">Horário de Início</label>
                                <input type="time" class="form-control" id="horario-inicio" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="horario-fim" class="form-label">Horário de Fim</label>
                                <input type="time" class="form-control" id="horario-fim" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveHorario()">Salvar Horário</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Plano de Aula -->
    <div class="modal fade" id="planoAulaModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Novo Plano de Aula</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="plano-aula-form">
                        <input type="hidden" id="plano-aula-id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="plano-aula-turma" class="form-label">Turma</label>
                                <select class="form-select" id="plano-aula-turma" required>
                                    <option value="" selected disabled>Selecione uma turma...</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="plano-aula-disciplina" class="form-label">Disciplina</label>
                                <select class="form-select" id="plano-aula-disciplina" required>
                                    <option value="" selected disabled>Selecione uma disciplina...</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="plano-aula-data" class="form-label">Data da Aula</label>
                                <input type="date" class="form-control" id="plano-aula-data" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="plano-aula-conteudo" class="form-label">Conteúdo</label>
                            <textarea class="form-control" id="plano-aula-conteudo" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="plano-aula-objetivos" class="form-label">Objetivos</label>
                            <textarea class="form-control" id="plano-aula-objetivos" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="plano-aula-atividades" class="form-label">Atividades</label>
                            <textarea class="form-control" id="plano-aula-atividades" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="savePlanoAula()">Salvar Plano</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========= SCRIPTS ========= -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        // --- GLOBAL STATE ---
        let db;
        let currentUser = null;
        let alunosTable, professoresTable, turmasTable, disciplinasTable, financeiroTable, devedoresTable, matriculasTable, horariosTable, planosAulaTable;
        let mapAlunos = {}, mapProfessores = {}, mapTurmas = {}, mapDisciplinas = {};

        // --- INDEXEDDB SETUP ---
        const DB_NAME = 'PolyglotAcademyDB';
        const DB_VERSION = 4; // Incremented version for new stores
        const STORES = {
            alunos: 'alunos', professores: 'professores', turmas: 'turmas', disciplinas: 'disciplinas',
            financeiro: 'financeiro', matriculas: 'matriculas', horarios: 'horarios',
            presencas: 'presencas', planosAula: 'planosAula'
        };

        function initDB() {
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            request.onerror = (event) => { console.error("IndexedDB error:", event.target.error); showToast("Erro ao inicializar o banco de dados.", "error"); };
            request.onsuccess = (event) => { db = event.target.result; console.log("IndexedDB initialized successfully."); checkAuthAndSeedData(); };
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                Object.values(STORES).forEach(storeName => {
                    if (!db.objectStoreNames.contains(storeName)) {
                        db.createObjectStore(storeName, { keyPath: 'id', autoIncrement: true });
                    }
                });
            };
        }

        // --- CRUD GENERIC FUNCTIONS ---
        function addData(storeName, data) { return new Promise((resolve, reject) => { const transaction = db.transaction([storeName], 'readwrite'); const store = transaction.objectStore(storeName); const request = store.add(data); request.onsuccess = () => resolve(request.result); request.onerror = () => reject(request.error); }); }
        function getAllData(storeName) { return new Promise((resolve, reject) => { const transaction = db.transaction([storeName], 'readonly'); const store = transaction.objectStore(storeName); const request = store.getAll(); request.onsuccess = () => resolve(request.result); request.onerror = () => reject(request.error); }); }
        function getDataById(storeName, id) { return new Promise((resolve, reject) => { const transaction = db.transaction([storeName], 'readonly'); const store = transaction.objectStore(storeName); const request = store.get(id); request.onsuccess = () => resolve(request.result); request.onerror = () => reject(request.error); }); }
        function updateData(storeName, data) { return new Promise((resolve, reject) => { const transaction = db.transaction([storeName], 'readwrite'); const store = transaction.objectStore(storeName); const request = store.put(data); request.onsuccess = () => resolve(request.result); request.onerror = () => reject(request.error); }); }
        function deleteData(storeName, id) { return new Promise((resolve, reject) => { const transaction = db.transaction([storeName], 'readwrite'); const store = transaction.objectStore(storeName); const request = store.delete(id); request.onsuccess = () => resolve(request.result); request.onerror = () => reject(request.error); }); }

        // --- AUTHENTICATION ---
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if ((username === 'admin' && password === 'admin') || (username === 'user' && password === 'user')) {
                currentUser = { username, role: username === 'admin' ? 'admin' : 'user', id: username === 'admin' ? 0 : 2 }; // Mock user ID
                localStorage.setItem('polyglotUser', JSON.stringify(currentUser));
                showApp();
            } else { Swal.fire('Erro!', 'Usuário ou senha inválidos.', 'error'); }
        });
        document.getElementById('logout-btn').addEventListener('click', (e) => { e.preventDefault(); localStorage.removeItem('polyglotUser'); currentUser = null; showLogin(); });
        function checkAuthAndSeedData() { const savedUser = localStorage.getItem('polyglotUser'); if (savedUser) { currentUser = JSON.parse(savedUser); showApp(); } else { showLogin(); } seedInitialData(); }
        function showApp() { document.getElementById('login-page').style.display = 'none'; document.getElementById('main-app').style.display = 'block'; document.getElementById('user-name').textContent = currentUser.username; document.getElementById('user-role').textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usuário'; }
        function showLogin() { document.getElementById('login-page').style.display = 'flex'; document.getElementById('main-app').style.display = 'none'; }

        // --- UI & NAVIGATION ---
        document.querySelectorAll('.sidebar .nav-link[data-page]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetPage = e.currentTarget.dataset.page;
                switchPage(targetPage);
                document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
                const navbarCollapse = document.getElementById('sidebar-nav');
                if (navbarCollapse.classList.contains('show')) { bootstrap.Collapse.getInstance(navbarCollapse).hide(); }
            });
        });
        function switchPage(pageId) {
            document.getElementById('page-title').textContent = pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('-', ' ');
            document.querySelectorAll('.page-container').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        // --- UTILITY FUNCTIONS ---
        function showLoadingSpinner() { document.getElementById('loading-spinner').classList.add('active'); }
        function hideLoadingSpinner() { document.getElementById('loading-spinner').classList.remove('active'); }
        function showToast(message, type = 'success') {
            Toastify({ text: message, duration: 3000, gravity: "top", position: "right", stopOnFocus: true, style: { background: type === 'success' ? "linear-gradient(to right, #00b09b, #96c93d)" : "linear-gradient(to right, #ff5f6d, #ffc371)", }, }).showToast();
        }
        async function populateDropdown(selector, store, placeholder) {
            const data = await getAllData(store);
            const select = document.getElementById(selector);
            select.innerHTML = `<option value="" selected disabled>${placeholder}</option>`;
            data.forEach(item => { const option = document.createElement('option'); option.value = item.id; option.textContent = item.nome; select.appendChild(option); });
        }

        // --- DATATABLES INITIALIZATION ---
        function initDataTables() {
            const licenseText = 'Licenciado pela AGT nº 473/AGT/2024';
            const commonOptions = {
                responsive: true, language: { url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/pt-BR.json" },
                dom: 'Bfrtip', buttons: [
                    { extend: 'copy', footer: true }, { extend: 'csv', footer: true, customize: function(xlsx) { xlsx.sheets[xlsx.sheetNames[0]]['!rows'].push([licenseText]); return xlsx; } },
                    { extend: 'excel', footer: true, customize: function(xlsx) { const sheet = xlsx.xl.worksheets['sheet1.xml']; const row = $('row', sheet); const lastRow = parseInt($(row[row.length-1]).attr('r'), 10); $(sheet).append(`<row r="${lastRow+1}"><c t="inlineStr" s="2" r="A${lastRow+1}"><is><t>${licenseText}</t></is></c></row>`); return xlsx; } },
                    { extend: 'pdf', footer: true, customize: function(doc) { doc.footer = (function(currentPage, pageCount) { return { text: licenseText, alignment: 'center', fontSize: 8, color: '#555' }; }); return doc; } },
                    { extend: 'print', footer: true }
                ]
            };
            alunosTable = $('#alunos-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'nome' }, { data: 'nascimento' }, { data: 'responsavel' }, { data: 'contato' }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-info" onclick="verContaCorrente(${row.id})"><i class="fas fa-eye"></i></button> <button class="btn btn-sm btn-warning" onclick="editAluno(${row.id})"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deleteAluno(${row.id})"><i class="fas fa-trash"></i></button>` }] });
            professoresTable = $('#professores-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'nome' }, { data: 'disciplina' }, { data: 'email' }, { data: 'contato' }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-warning" onclick="editProfessor(${row.id})"><i class="fas fa-edit"></i></button> ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteProfessor(${row.id})"><i class="fas fa-trash"></i></button>` : ''}` }] });
            turmasTable = $('#turmas-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'nome' }, { data: 'serie' }, { data: 'anoLetivo' }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-warning" onclick="editTurma(${row.id})"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deleteTurma(${row.id})"><i class="fas fa-trash"></i></button>` }] });
            disciplinasTable = $('#disciplinas-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'nome' }, { data: 'cargaHoraria' }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-warning" onclick="editDisciplina(${row.id})"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deleteDisciplina(${row.id})"><i class="fas fa-trash"></i></button>` }] });
            financeiroTable = $('#financeiro-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'alunoNome' }, { data: 'descricao' }, { data: 'valor', render: data => `R$ ${parseFloat(data).toFixed(2)}` }, { data: 'dataVencimento' }, { data: 'status', render: data => `<span class="status-${data.toLowerCase()}">${data}</span>` }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-warning" onclick="editFinanceiro(${row.id})"><i class="fas fa-edit"></i></button> ${row.status === 'Pago' ? `<button class="btn btn-sm btn-success" onclick="gerarRecibo(${row.id})"><i class="fas fa-print"></i></button>` : ''} <button class="btn btn-sm btn-danger" onclick="deleteFinanceiro(${row.id})"><i class="fas fa-trash"></i></button>` }] });
            devedoresTable = $('#devedores-table').DataTable({ ...commonOptions, columns: [{ data: 'alunoNome' }, { data: 'responsavel' }, { data: 'contato' }, { data: 'valorTotalDevido', render: data => `R$ ${parseFloat(data).toFixed(2)}` }] });
            matriculasTable = $('#matriculas-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'alunoNome' }, { data: 'turmaNome' }, { data: 'dataMatricula' }, { data: 'status', render: data => `<span class="status-${data.toLowerCase()}">${data}</span>` }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-danger" onclick="cancelarMatricula(${row.id})"><i class="fas fa-times"></i> Cancelar</button>` }] });
            horariosTable = $('#horarios-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'turmaNome' }, { data: 'disciplinaNome' }, { data: 'professorNome' }, { data: 'diaSemana' }, { data: null, render: (data, type, row) => `${row.horaInicio} - ${row.horaFim}` }, { data: null, render: (data, type, row) => `<button class="btn btn-sm btn-danger" onclick="deleteHorario(${row.id})"><i class="fas fa-trash"></i></button>` }] });
            planosAulaTable = $('#planos-aula-table').DataTable({ ...commonOptions, columns: [{ data: 'id' }, { data: 'professorNome' }, { data: 'turmaNome' }, { data: 'disciplinaNome' }, { data: 'dataAula' }, { data: 'conteudo', render: data => data.length > 50 ? data.substring(0, 50) + '...' : data }, { data: null, render: (data, type, row) => { const canEdit = currentUser.role === 'admin' || currentUser.id === row.professorId; return canEdit ? `<button class="btn btn-sm btn-warning" onclick="editPlanoAula(${row.id})"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deletePlanoAula(${row.id})"><i class="fas fa-trash"></i></button>` : ''; } }] });
        }

        // --- LOAD DATA INTO TABLES ---
        async function loadAllData() {
            showLoadingSpinner();
            const [alunos, professores, turmas, disciplinas, financeiro, matriculas, horarios, planosAula] = await Promise.all([
                getAllData(STORES.alunos), getAllData(STORES.professores), getAllData(STORES.turmas), getAllData(STORES.disciplinas),
                getAllData(STORES.financeiro), getAllData(STORES.matriculas), getAllData(STORES.horarios), getAllData(STORES.planosAula)
            ]);
            mapAlunos = alunos.reduce((map, a) => { map[a.id] = a; return map; }, {});
            mapProfessores = professores.reduce((map, p) => { map[p.id] = p; return map; }, {});
            mapTurmas = turmas.reduce((map, t) => { map[t.id] = t; return map; }, {});
            mapDisciplinas = disciplinas.reduce((map, d) => { map[d.id] = d; return map; }, {});
            alunosTable.clear().rows.add(alunos).draw();
            professoresTable.clear().rows.add(professores).draw();
            turmasTable.clear().rows.add(turmas).draw();
            disciplinasTable.clear().rows.add(disciplinas).draw();
            const financeiroWithNames = financeiro.map(f => ({ ...f, alunoNome: mapAlunos[f.alunoId]?.nome || 'N/A' }));
            financeiroTable.clear().rows.add(financeiroWithNames).draw();
            const matriculasWithNames = matriculas.map(m => ({ ...m, alunoNome: mapAlunos[m.alunoId]?.nome || 'N/A', turmaNome: mapTurmas[m.turmaId]?.nome || 'N/A' }));
            matriculasTable.clear().rows.add(matriculasWithNames).draw();
            const horariosWithNames = horarios.map(h => ({ ...h, turmaNome: mapTurmas[h.turmaId]?.nome || 'N/A', disciplinaNome: mapDisciplinas[h.disciplinaId]?.nome || 'N/A', professorNome: mapProfessores[h.professorId]?.nome || 'N/A' }));
            horariosTable.clear().rows.add(horariosWithNames).draw();
            const planosWithNames = planosAula.map(p => ({ ...p, professorNome: mapProfessores[p.professorId]?.nome || 'N/A', turmaNome: mapTurmas[p.turmaId]?.nome || 'N/A', disciplinaNome: mapDisciplinas[p.disciplinaId]?.nome || 'N/A' }));
            planosAulaTable.clear().rows.add(planosWithNames).draw();
            await populateDropdown('financeiro-aluno', STORES.alunos, 'Selecione um aluno...');
            await populateDropdown('matricula-aluno', STORES.alunos, 'Selecione um aluno...');
            await populateDropdown('matricula-turma', STORES.turmas, 'Selecione uma turma...');
            await populateDropdown('horario-turma', STORES.turmas, 'Selecione uma turma...');
            await populateDropdown('horario-disciplina', STORES.disciplinas, 'Selecione uma disciplina...');
            await populateDropdown('horario-professor', STORES.professores, 'Selecione um professor...');
            await populateDropdown('presenca-turma', STORES.turmas, 'Selecione uma turma...');
            await populateDropdown('select-professor-horario', STORES.professores, 'Selecione um professor...');
            await populateDropdown('select-turma-horario', STORES.turmas, 'Selecione uma turma...');
            await populateDropdown('plano-aula-turma', STORES.turmas, 'Selecione uma turma...');
            await populateDropdown('plano-aula-disciplina', STORES.disciplinas, 'Selecione uma disciplina...');
            document.getElementById('total-alunos').textContent = alunos.length;
            document.getElementById('total-professores').textContent = professores.length;
            document.getElementById('total-turmas').textContent = turmas.length;
            document.getElementById('total-matriculas').textContent = matriculas.filter(m => m.status === 'Ativa').length;
            const devedoresMap = {};
            financeiro.forEach(l => { if (l.status === 'Pendente') { if (!devedoresMap[l.alunoId]) devedoresMap[l.alunoId] = { alunoNome: mapAlunos[l.alunoId]?.nome, responsavel: mapAlunos[l.alunoId]?.responsavel, contato: mapAlunos[l.alunoId]?.contato, valorTotalDevido: 0 }; devedoresMap[l.alunoId].valorTotalDevido += parseFloat(l.valor); } });
            devedoresTable.clear().rows.add(Object.values(devedoresMap)).draw();
            hideLoadingSpinner();
        }

        // --- FORM HANDLERS (Aluno, Professor, Turma, Disciplina, Financeiro) ---
        function openAlunoModal() { document.getElementById('aluno-form').reset(); document.getElementById('aluno-id').value = ''; }
        async function editAluno(id) { const aluno = await getDataById(STORES.alunos, id); if(aluno){ Object.keys(aluno).forEach(k => { const el = document.getElementById(`aluno-${k}`); if(el) el.value = aluno[k]; }); new bootstrap.Modal('#alunoModal').show(); } }
        async function saveAluno() { const id = document.getElementById('aluno-id').value; const data = { nome: document.getElementById('aluno-nome').value, nascimento: document.getElementById('aluno-nascimento').value, responsavel: document.getElementById('aluno-responsavel').value, contato: document.getElementById('aluno-contato').value }; if(id){ data.id = parseInt(id); await updateData(STORES.alunos, data); showToast("Aluno atualizado!"); } else { await addData(STORES.alunos, data); showToast("Aluno cadastrado!"); } bootstrap.Modal.getInstance('#alunoModal').hide(); loadAllData(); }
        async function deleteAluno(id) { const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.alunos, id); showToast("Aluno deletado!"); loadAllData(); } }
        function openProfessorModal() { document.getElementById('professor-form').reset(); document.getElementById('professor-id').value = ''; }
        async function editProfessor(id) { const prof = await getDataById(STORES.professores, id); if(prof){ Object.keys(prof).forEach(k => { const el = document.getElementById(`professor-${k}`); if(el) el.value = prof[k]; }); new bootstrap.Modal('#professorModal').show(); } }
        async function saveProfessor() { const id = document.getElementById('professor-id').value; const data = { nome: document.getElementById('professor-nome').value, disciplina: document.getElementById('professor-disciplina').value, email: document.getElementById('professor-email').value, contato: document.getElementById('professor-contato').value }; if(id){ data.id = parseInt(id); await updateData(STORES.professores, data); showToast("Professor atualizado!"); } else { await addData(STORES.professores, data); showToast("Professor cadastrado!"); } bootstrap.Modal.getInstance('#professorModal').hide(); loadAllData(); }
        async function deleteProfessor(id) { if(currentUser.role !== 'admin'){ showToast("Sem permissão.", "error"); return; } const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.professores, id); showToast("Professor deletado!"); loadAllData(); } }
        function openTurmaModal() { document.getElementById('turma-form').reset(); document.getElementById('turma-id').value = ''; }
        async function editTurma(id) { const turma = await getDataById(STORES.turmas, id); if(turma){ Object.keys(turma).forEach(k => { const el = document.getElementById(`turma-${k}`); if(el) el.value = turma[k]; }); new bootstrap.Modal('#turmaModal').show(); } }
        async function saveTurma() { const id = document.getElementById('turma-id').value; const data = { nome: document.getElementById('turma-nome').value, serie: document.getElementById('turma-serie').value, anoLetivo: document.getElementById('turma-ano').value }; if(id){ data.id = parseInt(id); await updateData(STORES.turmas, data); showToast("Turma atualizada!"); } else { await addData(STORES.turmas, data); showToast("Turma cadastrada!"); } bootstrap.Modal.getInstance('#turmaModal').hide(); loadAllData(); }
        async function deleteTurma(id) { const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.turmas, id); showToast("Turma deletada!"); loadAllData(); } }
        function openDisciplinaModal() { document.getElementById('disciplina-form').reset(); document.getElementById('disciplina-id').value = ''; }
        async function editDisciplina(id) { const disc = await getDataById(STORES.disciplinas, id); if(disc){ Object.keys(disc).forEach(k => { const el = document.getElementById(`disciplina-${k}`); if(el) el.value = disc[k]; }); new bootstrap.Modal('#disciplinaModal').show(); } }
        async function saveDisciplina() { const id = document.getElementById('disciplina-id').value; const data = { nome: document.getElementById('disciplina-nome').value, cargaHoraria: document.getElementById('disciplina-carga').value }; if(id){ data.id = parseInt(id); await updateData(STORES.disciplinas, data); showToast("Disciplina atualizada!"); } else { await addData(STORES.disciplinas, data); showToast("Disciplina cadastrada!"); } bootstrap.Modal.getInstance('#disciplinaModal').hide(); loadAllData(); }
        async function deleteDisciplina(id) { const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.disciplinas, id); showToast("Disciplina deletada!"); loadAllData(); } }
        function openFinanceiroModal() { document.getElementById('financeiro-form').reset(); document.getElementById('financeiro-id').value = ''; }
        async function editFinanceiro(id) { const fin = await getDataById(STORES.financeiro, id); if(fin){ Object.keys(fin).forEach(k => { const el = document.getElementById(`financeiro-${k}`); if(el) el.value = fin[k]; }); new bootstrap.Modal('#financeiroModal').show(); } }
        async function saveFinanceiro() { const id = document.getElementById('financeiro-id').value; const data = { alunoId: parseInt(document.getElementById('financeiro-aluno').value), descricao: document.getElementById('financeiro-descricao').value, valor: document.getElementById('financeiro-valor').value, dataVencimento: document.getElementById('financeiro-vencimento').value, status: document.getElementById('financeiro-status').value }; if(id){ data.id = parseInt(id); await updateData(STORES.financeiro, data); showToast("Lançamento atualizado!"); } else { await addData(STORES.financeiro, data); showToast("Lançamento cadastrado!"); } bootstrap.Modal.getInstance('#financeiroModal').hide(); loadAllData(); }
        async function deleteFinanceiro(id) { const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.financeiro, id); showToast("Lançamento deletado!"); loadAllData(); } }
        async function gerarRecibo(id) {
            const lancamento = await getDataById(STORES.financeiro, id);
            const aluno = mapAlunos[lancamento.alunoId];
            const reciboHTML = `
                <div class="receipt-header">
                    <h4>Polyglot Academy</h4>
                    <p><strong>Recibo de Pagamento</strong></p>
                </div>
                <div class="receipt-body-content">
                    <p><strong>Recibo Nº:</strong> ${String(lancamento.id).padStart(6, '0')}</p>
                    <p><strong>Data de Emissão:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>
                    <hr>
                    <p><strong>Aluno:</strong> ${aluno.nome}</p>
                    <p><strong>Descrição:</strong> ${lancamento.descricao}</p>
                    <p><strong>Valor Pago:</strong> R$ ${parseFloat(lancamento.valor).toFixed(2)}</p>
                    <p><strong>Data de Pagamento:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>
                </div>
                <div class="receipt-footer">
                    <p>Licenciado pela AGT nº 473/AGT/2024</p>
                </div>
            `;
            document.getElementById('receipt-content').innerHTML = reciboHTML;
            new bootstrap.Modal('#receipt-modal').show();
        }
        async function verContaCorrente(alunoId) {
            const aluno = mapAlunos[alunoId];
            const lancamentos = await getAllData(STORES.financeiro);
            const lancamentosAluno = lancamentos.filter(l => l.alunoId == alunoId);
            let totalDevido = 0;
            let tbodyHTML = '';
            lancamentosAluno.forEach(l => {
                if (l.status === 'Pendente') totalDevido += parseFloat(l.valor);
                tbodyHTML += `<tr><td>${l.dataVencimento}</td><td>${l.descricao}</td><td>R$ ${parseFloat(l.valor).toFixed(2)}</td><td><span class="status-${l.status.toLowerCase()}">${l.status}</span></td></tr>`;
            });
            document.getElementById('conta-corrente-aluno-nome').textContent = `Extrato de: ${aluno.nome}`;
            document.getElementById('conta-corrente-tbody').innerHTML = tbodyHTML;
            document.getElementById('conta-corrente-total').textContent = `R$ ${totalDevido.toFixed(2)}`;
            new bootstrap.Modal('#contaCorrenteModal').show();
        }

        // --- MATRICULA HANDLERS ---
        function openMatriculaModal() { document.getElementById('matricula-form').reset(); document.getElementById('matricula-data').value = new Date().toISOString().split('T')[0]; }
        async function saveMatricula() { const data = { alunoId: parseInt(document.getElementById('matricula-aluno').value), turmaId: parseInt(document.getElementById('matricula-turma').value), dataMatricula: document.getElementById('matricula-data').value, status: 'Ativa' }; await addData(STORES.matriculas, data); showToast("Matrícula realizada com sucesso!"); bootstrap.Modal.getInstance('#matriculaModal').hide(); loadAllData(); }
        async function cancelarMatricula(id) { const matricula = await getDataById(STORES.matriculas, id); if(matricula) { matricula.status = 'Inativa'; await updateData(STORES.matriculas, matricula); showToast("Matrícula cancelada."); loadAllData(); } }

        // --- HORARIO HANDLERS ---
        function openHorarioModal() { document.getElementById('horario-form').reset(); }
        async function saveHorario() { const data = { turmaId: parseInt(document.getElementById('horario-turma').value), disciplinaId: parseInt(document.getElementById('horario-disciplina').value), professorId: parseInt(document.getElementById('horario-professor').value), diaSemana: document.getElementById('horario-dia').value, horaInicio: document.getElementById('horario-inicio').value, horaFim: document.getElementById('horario-fim').value }; await addData(STORES.horarios, data); showToast("Horário adicionado com sucesso!"); bootstrap.Modal.getInstance('#horarioModal').hide(); loadAllData(); }
        async function deleteHorario(id) { const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.horarios, id); showToast("Horário deletado!"); loadAllData(); } }
        async function gerarHorario(tipo, id) { const horarios = await getAllData(STORES.horarios); const filtered = tipo === 'professor' ? horarios.filter(h => h.professorId == id) : horarios.filter(h => h.turmaId == id); const dias = ['Segunda', 'Terca', 'Quarta', 'Quinta', 'Sexta']; const horarioMap = {}; dias.forEach(dia => horarioMap[dia] = []); filtered.forEach(h => { horarioMap[h.diaSemana].push(h); }); let html = `<table class="schedule-table"><thead><tr><th>Hora</th><th>Segunda</th><th>Terça</th><th>Quarta</th><th>Quinta</th><th>Sexta</th></tr></thead><tbody>`; const times = ['07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00']; times.forEach(time => { html += `<tr><td>${time}</td>`; dias.forEach(dia => { const item = horarioMap[dia].find(h => h.horaInicio <= time && h.horaFim > time); html += `<td>${item ? `<div class="schedule-item" title="${item.disciplinaNome} - ${item.professorNome}">${item.disciplinaNome}</div>` : ''}</td>`; }); html += `</tr>`; }); html += `</tbody></table>`; return html; }
        document.getElementById('select-professor-horario')?.addEventListener('change', (e) => { if(e.target.value) gerarHorario('professor', e.target.value).then(html => document.getElementById('horario-professor-view').innerHTML = html); });
        document.getElementById('select-turma-horario')?.addEventListener('change', (e) => { if(e.target.value) gerarHorario('turma', e.target.value).then(html => document.getElementById('horario-turma-view').innerHTML = html); });

        // --- PRESENCA HANDLERS ---
        async function carregarListaPresenca() { const turmaId = document.getElementById('presenca-turma').value; const data = document.getElementById('presenca-data').value; if (!turmaId || !data) { showToast("Selecione a turma e a data.", "error"); return; } const matriculas = await getAllData(STORES.matriculas); const alunosMatriculadosIds = matriculas.filter(m => m.turmaId == turmaId && m.status === 'Ativa').map(m => m.alunoId); const alunos = (await getAllData(STORES.alunos)).filter(a => alunosMatriculadosIds.includes(a.id)); let html = `<h5>Lista de Presença - ${mapTurmas[turmaId].nome} - ${data}</h5><form id="form-presenca"><table class="table"><thead><tr><th>Aluno</th><th>Presente</th></tr></thead><tbody>`; alunos.forEach(a => { html += `<tr><td>${a.nome}</td><td><input type="checkbox" class="form-check-input" name="presenca" value="${a.id}" checked></td></tr>`; }); html += `</tbody></table><button type="button" class="btn btn-primary" onclick="salvarPresenca(${turmaId}, '${data}')">Salvar Presença</button></form>`; document.getElementById('presenca-list-container').innerHTML = html; }
        async function salvarPresenca(turmaId, data) { const form = document.getElementById('form-presenca'); const checkboxes = form.querySelectorAll('input[name="presenca"]:checked'); const presentes = Array.from(checkboxes).map(cb => parseInt(cb.value)); const ausentes = (await getAllData(STORES.alunos)).filter(a => !presentes.includes(a.id)).map(a => a.id); const presencaData = { turmaId, dataAula: data, presentes, ausentes }; await addData(STORES.presencas, presencaData); showToast("Presença salva com sucesso!"); document.getElementById('presenca-list-container').innerHTML = ''; }

        // --- PLANO DE AULA HANDLERS ---
        function openPlanoAulaModal() { document.getElementById('plano-aula-form').reset(); document.getElementById('plano-aula-id').value = ''; }
        async function savePlanoAula() { const id = document.getElementById('plano-aula-id').value; const data = { professorId: currentUser.id, turmaId: parseInt(document.getElementById('plano-aula-turma').value), disciplinaId: parseInt(document.getElementById('plano-aula-disciplina').value), dataAula: document.getElementById('plano-aula-data').value, conteudo: document.getElementById('plano-aula-conteudo').value, objetivos: document.getElementById('plano-aula-objetivos').value, atividades: document.getElementById('plano-aula-atividades').value }; if(id){ data.id = parseInt(id); await updateData(STORES.planosAula, data); showToast("Plano de Aula atualizado!"); } else { await addData(STORES.planosAula, data); showToast("Plano de Aula cadastrado!"); } bootstrap.Modal.getInstance('#planoAulaModal').hide(); loadAllData(); }
        async function editPlanoAula(id) { const plano = await getDataById(STORES.planosAula, id); if(plano){ Object.keys(plano).forEach(k => { const el = document.getElementById(`plano-aula-${k}`); if(el) el.value = plano[k]; }); new bootstrap.Modal('#planoAulaModal').show(); } }
        async function deletePlanoAula(id) { const res = await Swal.fire({ title: 'Tem certeza?', text: "Não poderá reverter!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'Sim, deletar!' }); if(res.isConfirmed){ await deleteData(STORES.planosAula, id); showToast("Plano de Aula deletado!"); loadAllData(); } }


        // --- INITIALIZATION ON PAGE LOAD ---
        $(document).ready(function() {
            initDB();
            initDataTables();
            document.querySelector('[data-page="dashboard"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="secretaria"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="pedagogico"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="planos-aula"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="financeiro"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="matriculas"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="horarios"]').addEventListener('click', loadAllData);
            document.querySelector('[data-page="presenca"]').addEventListener('click', loadAllData);
        });

        async function seedInitialData() {
            const alunosCount = (await getAllData(STORES.alunos)).length;
            if (alunosCount > 0) return;
            const seedData = {
                alunos: [{ nome: 'Ana Silva', nascimento: '2015-03-10', responsavel: 'Maria Silva', contato: '(11) 98765-4321' }, { nome: 'Bruno Costa', nascimento: '2014-07-22', responsavel: 'João Costa', contato: '(11) 91234-5678' }, { nome: 'Carla Dias', nascimento: '2015-11-05', responsavel: 'Cláudia Dias', contato: '(11) 99876-5432' }],
                professores: [{ id: 2, nome: 'Profa. Juliana Martins', disciplina: 'Português', email: 'juliana.m@polyglot.com', contato: '(11) 96543-2109' }],
                turmas: [{ nome: '1º Ano A', serie: '1º Ano Ensino Fundamental', anoLetivo: 2024 }],
                disciplinas: [{ nome: 'Português', cargaHoraria: 200 }],
                financeiro: [{ alunoId: 1, descricao: 'Mensalidade - Março/2024', valor: 450.00, dataVencimento: '2024-03-10', status: 'Pago' }],
                matriculas: [{ alunoId: 1, turmaId: 1, dataMatricula: '2024-01-15', status: 'Ativa' }],
                horarios: [{ turmaId: 1, disciplinaId: 1, professorId: 2, diaSemana: 'Segunda', horaInicio: '08:00', horaFim: '09:00' }],
                planosAula: [{ professorId: 2, turmaId: 1, disciplinaId: 1, dataAula: '2024-05-21', conteudo: 'Alfabeto', objetivos: 'Aprender as vogais', atividades: 'Cantigas e jogos' }]
            };
            for (const store in seedData) { for (const item of seedData[store]) { await addData(store, item); } }
            console.log("Initial data seeded.");
        }
    </script>
</body>
</html>
